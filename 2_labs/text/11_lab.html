<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lab 11 - Camera Data Processing - BPC-PRP - Practical Robotics and Computer Vision</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../title-page.html">Introduction</a></li><li class="chapter-item expanded "><a href="../../1_lectures/text/intro.html"><strong aria-hidden="true">1.</strong> Lectures</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/intro.html"><strong aria-hidden="true">2.</strong> Labs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../2_labs/text/1_lab.html"><strong aria-hidden="true">2.1.</strong> Lab 1 - Introduction &amp; Linux Installation</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/2_lab.html"><strong aria-hidden="true">2.2.</strong> Lab 2 - IDE, C++ &amp; CMake</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/3_lab.html"><strong aria-hidden="true">2.3.</strong> Lab 3 - Git &amp; C++ Project Template</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/4_lab.html"><strong aria-hidden="true">2.4.</strong> Lab 4 - Data Capture &amp; Visualization (ROS)</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/5_lab.html"><strong aria-hidden="true">2.5.</strong> Lab 5 - Motor, Kinematics &amp; Gamepad</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/6_lab.html"><strong aria-hidden="true">2.6.</strong> Lab 6 - Line Estimation</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/7_lab.html"><strong aria-hidden="true">2.7.</strong> Lab 7 - Line Following &amp; PID</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/8_lab.html"><strong aria-hidden="true">2.8.</strong> Lab 8 - Exam (Line Following)</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/9_lab.html"><strong aria-hidden="true">2.9.</strong> Lab 9 - Obstacle Detection &amp; Corridor Following</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/10_lab.html"><strong aria-hidden="true">2.10.</strong> Lab 10 - Orientation-Aware Corridor Navigation</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/11_lab.html" class="active"><strong aria-hidden="true">2.11.</strong> Lab 11 - Camera Data Processing</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/12_lab.html"><strong aria-hidden="true">2.12.</strong> Lab 12 - Exam (Corridor Following)</a></li><li class="chapter-item expanded "><a href="../../2_labs/text/13_exam.html"><strong aria-hidden="true">2.13.</strong> Main Exam - Maze Escape</a></li></ol></li><li class="chapter-item expanded "><a href="../../3_navigation/text/intro.html"><strong aria-hidden="true">3.</strong> Robotic Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../3_navigation/text/1_differential_chassis.html"><strong aria-hidden="true">3.1.</strong> Differential Chassis</a></li><li class="chapter-item expanded "><a href="../../3_navigation/text/2_pid.html"><strong aria-hidden="true">3.2.</strong> PID</a></li><li class="chapter-item expanded "><a href="../../3_navigation/text/3_line_following.html"><strong aria-hidden="true">3.3.</strong> Line Following</a></li><li class="chapter-item expanded "><a href="../../3_navigation/text/4_corridor_following.html"><strong aria-hidden="true">3.4.</strong> Corridor Following</a></li><li class="chapter-item expanded "><a href="../../3_navigation/text/5_imu.html"><strong aria-hidden="true">3.5.</strong> IMU</a></li><li class="chapter-item expanded "><a href="../../3_navigation/text/6_maze_escape.html"><strong aria-hidden="true">3.6.</strong> Maze Escape</a></li></ol></li><li class="chapter-item expanded "><a href="../../4_others/text/intro.html"><strong aria-hidden="true">4.</strong> Others</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../4_others/text/1_linux.html"><strong aria-hidden="true">4.1.</strong> Linux</a></li><li class="chapter-item expanded "><a href="../../4_others/text/2_cpp.html"><strong aria-hidden="true">4.2.</strong> C++</a></li><li class="chapter-item expanded "><a href="../../4_others/text/7_cmake.html"><strong aria-hidden="true">4.3.</strong> CMake</a></li><li class="chapter-item expanded "><a href="../../4_others/text/3_git.html"><strong aria-hidden="true">4.4.</strong> Git</a></li><li class="chapter-item expanded "><a href="../../4_others/text/4_clion.html"><strong aria-hidden="true">4.5.</strong> CLion</a></li><li class="chapter-item expanded "><a href="../../4_others/text/8_multithreading.html"><strong aria-hidden="true">4.6.</strong> Multithreading</a></li><li class="chapter-item expanded "><a href="../../4_others/text/9_rviz2_visualizations.html"><strong aria-hidden="true">4.7.</strong> RViz2 Visualizations</a></li><li class="chapter-item expanded "><a href="../../4_others/text/10_coordinate_system.html"><strong aria-hidden="true">4.8.</strong> Coordinate Systems</a></li><li class="chapter-item expanded "><a href="../../4_others/text/11_communication_buses.html"><strong aria-hidden="true">4.9.</strong> Communication Buses</a></li><li class="chapter-item expanded "><a href="../../4_others/text/12_ubuntu_environment.html"><strong aria-hidden="true">4.10.</strong> Ubuntu Environment</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">BPC-PRP - Practical Robotics and Computer Vision</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lab-11---visual-navigation-using-aruco-markers"><a class="header" href="#lab-11---visual-navigation-using-aruco-markers">Lab 11 - Visual Navigation Using ArUco Markers</a></h1>
<p>Responsible: Ing. Petr Šopák</p>
<h3 id="learning-objectives"><a class="header" href="#learning-objectives">Learning Objectives</a></h3>
<p><strong>1) Camera-based detection of visual markers</strong></p>
<ul>
<li>Subscribing to a camera image topic</li>
<li>Converting ROS image messages to OpenCV format</li>
<li>Detecting ArUco markers using a provided detector</li>
</ul>
<p><strong>2) Using markers for high-level decision making</strong></p>
<ul>
<li>Associating marker IDs with semantic instructions (e.g., “turn left”, “goal”)</li>
<li>Storing and reusing symbolic information</li>
<li>Implementing logic that uses past observations during navigation</li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>In previous labs, you explored sensor-based navigation using range sensors and IMUs. These approaches allowed the robot to react to its surroundings, but they did not provide access to symbolic information or long-term guidance.</p>
<p>In this lab, your robot will <strong>navigate through a maze where ArUco markers act as visual hints</strong>. These markers are placed at strategic locations and convey semantic instructions, such as which direction to take at an intersection, or where a shortcut to a goal (e.g., treasure) can be found.</p>
<p>The robot’s goal is to <strong>detect the markers, interpret their meaning, and use this information later</strong> when making decisions in the maze. This symbolic memory allows the robot to act in a more informed and efficient way, rather than relying solely on reactive behaviors.</p>
<h2 id="camera-and-marker-detection-approx-50-minutes"><a class="header" href="#camera-and-marker-detection-approx-50-minutes">Camera and Marker Detection (Approx. 50 minutes)</a></h2>
<p>In the first part of the lab, you will implement a ROS 2 node (<code>CameraNode</code>) that subscribes to a camera image stream, converts the received image into OpenCV format, and detects ArUco markers.</p>
<h2 id="you-are-provided-with-a-partial-implementation-of-the-arucodetector-class-your-task-is-to-complete-this-class-and-integrate-it-into-your-ros-node"><a class="header" href="#you-are-provided-with-a-partial-implementation-of-the-arucodetector-class-your-task-is-to-complete-this-class-and-integrate-it-into-your-ros-node">You are provided with a partial implementation of the <code>ArucoDetector</code> class. Your task is to complete this class and integrate it into your ROS node.</a></h2>
<p><strong>TASK 1 – Camera Subscription and Marker Detection</strong></p>
<ol>
<li>Create a new ROS 2 node - <code>camera_node</code>
<ul>
<li>Subscribe to a camera image topic using <code>image_transport</code></li>
<li>In the callback, convert the incoming message to a <code>cv::Mat</code> (OpenCV image)</li>
<li>Make sure the encoding is <code>bgr8</code> before accessing raw data</li>
</ul>
</li>
<li><strong>Detect ArUco markers in the image</strong>:
<ul>
<li>Use the provided <code>aruco_detector.hpp</code> (insert it to <code>algorithms</code> folder) and complete the class</li>
<li>The detector will return a list of marker IDs and corner coordinates
<pre><code class="language-c++"> #include &lt;opencv2/opencv.hpp&gt;
 #include &lt;opencv2/aruco.hpp&gt;
 
 namespace algorithms {
 
     class ArucoDetector {
     public:
 
         // Represents one detected marker
         struct Aruco {
             int id;
             std::vector&lt;cv::Point2f&gt; corners;
         };
 
         ArucoDetector() {
             // Initialize dictionary with 4x4 markers (50 possible IDs)
             dictionary_ = cv::aruco::getPredefinedDictionary(cv::aruco::DICT_4X4_50);
         }
 
         ~ArucoDetector() = default;
 
         // Detect markers in the input image
         std::vector&lt;Aruco&gt; detect(cv::Mat frame) {
             std::vector&lt;Aruco&gt; arucos;
 
             std::vector&lt;int&gt; marker_ids;
             std::vector&lt;std::vector&lt;cv::Point2f&gt;&gt; marker_corners;
 
             // TODO: Detect markers using OpenCV
             // cv::aruco::detectMarkers(...);
 
             if (!marker_ids.empty()) {
                 std::cout &lt;&lt; &quot;Arucos found: &quot;;
                 for (size_t i = 0; i &lt; marker_ids.size(); i++) {
                     std::cout &lt;&lt; marker_ids[i] &lt;&lt; &quot; &quot;;
 
                     // TODO: Create Aruco struct and add to result vector
                     // arucos.emplace_back(...);
                 }
                 std::cout &lt;&lt; std::endl;
             }
 
             return arucos;
         }
 
     private:
         cv::Ptr&lt;cv::aruco::Dictionary&gt; dictionary_;
     };
 }
</code></pre>
</li>
</ul>
</li>
<li><strong>Store the last frame and detection results</strong>:
<ul>
<li>Save the latest image (<code>cv::Mat</code>) and detection data (<code>std::vector&lt;Aruco&gt;</code>)</li>
</ul>
</li>
<li><strong>Visualize the incoming camera stream</strong>
<ul>
<li>Publish the (optionally annotated) image using <code>image_transport::Publisher</code></li>
<li>View the image in <strong>rqt_image_view</strong> or <strong>RViz</strong> for debugging</li>
<li>(Optional) Overlay detected markers on the image using <code>cv::aruco::drawDetectedMarkers</code> before publishing</li>
</ul>
</li>
</ol>
<h2 id="symbolic-navigation-logic-approx-40-minutes"><a class="header" href="#symbolic-navigation-logic-approx-40-minutes">Symbolic Navigation Logic (Approx. 40 minutes)</a></h2>
<p>In the second part of the lab, you will design logic that interprets the detected ArUco markers as instructions for maze navigation. Some markers indicate directions that lead to the exit, while others point toward the treasure. Your robot must recognize and remember these instructions, and then apply them later at decision points.</p>
<p>As illustrated in the figure 1, each instruction obtained from an ArUco marker is <strong>always intended for the next upcoming intersection</strong>. The robot must remember the marker’s content and apply it at the first junction it encounters after reading the marker.</p>
<p id="state_machine" align="center">
  <img src="../images/lab11_maze_example.png" alt="alt text" width="450" height="600">
</p>
<p align="center">
    <em> Figure 1: Example of decision-making using ArUco markers in a maze </em>
</p>
<hr />
<p><strong>TASK 2 - Maze Logic and Decision Making</strong></p>
<ol>
<li>In your <strong>maze loop node</strong> (or a separate logic node):
<ul>
<li>Use the data obtained from the previous task</li>
<li>Define a mapping between marker IDs and symbolic instructions (see table below)</li>
<li>Remember that there are two types of markers: one for the <strong>exit path</strong>, and one for the <strong>treasure path</strong></li>
</ul>
<pre><code class="language-c++">Escape path:              Treasure Path:
ID = 1 -&gt; straight        ID = 10 -&gt; straight
ID = 2 -&gt; left            ID = 11 -&gt; left
ID = 3 -&gt; right           ID = 12 -&gt; right
</code></pre>
</li>
<li>Integrate the symbolic information into navigation logic
<ul>
<li>When a marker is detected, store the ID and its meaning</li>
<li>When the robot reaches the first intersection or decision point, use the stored instruction to select the direction</li>
<li>Based on the instruction (e.g., turn left), command the robot to rotate and follow the chosen path</li>
</ul>
<blockquote>
<p>TIP: Define which path (escape or treasure) has higher priority</p>
</blockquote>
</li>
<li>Test your logic and outputs</li>
</ol>
<h2 id="final-note"><a class="header" href="#final-note">Final Note</a></h2>
<p>This is the last lab in the course. We hope it helped you better understand the connection between perception, memory, and decision-making in robotics. You’ve now completed a full pipeline—from reading sensor data to interpreting symbolic cues and applying them in complex navigation tasks.</p>
<p>Good luck with your upcoming <strong>exam and final evaluation</strong>. Stay curious, keep experimenting, and don’t be afraid to challenge your solutions. We’ll be happy to see if you decide to join another course from our <strong>Robotics group</strong> in the future.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../2_labs/text/10_lab.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../2_labs/text/12_lab.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../2_labs/text/10_lab.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../2_labs/text/12_lab.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
